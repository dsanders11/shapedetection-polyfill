<script src="../zxing/require_zxing_compiled.js"></script>

<script src="shapedetection.js"></script>

<script>
window.onload = function() {
  var img = new Image();
  img.crossOrigin = "Anonymous";
  document.body.appendChild(img);

  img.onload = function() {

    var footer = document.getElementsByTagName('footer')[0];

    var bc = new BarcodeDetector();

    bc.detect(img)
        .then((barcodes) => {
   	      for(var i = 0; i < barcodes.length; i++) {
            footer.innerHTML = '+ found: ' + barcodes[i].rawValue + '\n';
            console.log('Found sth: ' + barcodes[i].rawValue + '\n');
          }
        })
        .catch( (error) => {
          footer.innerHTML = 'detection failed: ' + error;
          console.error(error);
        });
  }

  // First doesn't work and has troubles other times: transparency??
  //img.src = 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/9b/Wikipedia_mobile_en.svg/200px-Wikipedia_mobile_en.svg.png';

  // Works fine
  // img.src = "https://upload.wikimedia.org/wikipedia/commons/d/d7/Commons_QR_code.png";

  // Works too (synthetic)
  //img.src = "https://upload.wikimedia.org/wikipedia/commons/thumb/e/e7/Jebel_Musa_QRcode.jpg/293px-Jebel_Musa_QRcode.jpg";

  // Not working, too hard.
  //img.src = "https://upload.wikimedia.org/wikipedia/commons/thumb/3/32/Japan-qr-code-billboard.jpg/360px-Japan-qr-code-billboard.jpg";

  // This has many different 2D codes.
  img.src = "https://upload.wikimedia.org/wikipedia/commons/c/cb/Codes4.png"

  //img.src = "https://upload.wikimedia.org/wikipedia/commons/thumb/2/20/Azteccodeexample.svg/184px-Azteccodeexample.svg.png"

  // Works as well.
  //img.src = "https://upload.wikimedia.org/wikipedia/en/f/f4/LiveBarcodeApp.jpg";

}
</script>
<footer></footer>
